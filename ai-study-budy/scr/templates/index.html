<!DOCTYPE html>
<html>
<head>
  <title>Study Buddy Chatbot</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <div class="container">
    <h1>Ask Study Buddy</h1>
    <form id="qa-form">
      <input type="text" name="user_input" placeholder="Hi I'm your study buddy, ask me a question ..." required>
      <input type="submit" value="Ask">
    </form>

    <div id="loading-indicator" class="loading-indicator" style="display:none;">
      <p>Study Buddy is thinking...</p>
      <div class="spinner"></div>
    </div>

    <div id="response" class="response" style="display:none;"></div>
  </div>

 <script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("qa-form");
    const userInput = form.querySelector('input[name="user_input"]');
    const submitButton = form.querySelector('input[type="submit"]');
    const loadingIndicator = document.getElementById("loading-indicator");
    const responseDiv = document.getElementById("response");

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const question = userInput.value.trim();

      if (!question) {
        responseDiv.textContent = "Please type a question.";
        responseDiv.style.display = "block";
        return;
      }

      // Prepare UI
      responseDiv.style.display = "none";
      responseDiv.innerHTML = "";
      submitButton.disabled = true;
      userInput.disabled = true;
      submitButton.value = "Asking...";

      // Show spinner
      loadingIndicator.style.display = "block";

      // Delay fetch to ensure spinner is shown
      setTimeout(() => {
        fetch("/ask", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ user_input: question })
        })
        .then(response => response.json())
        .then(data => {
          responseDiv.innerHTML = `<p><strong>Buddy:</strong> ${data.response}</p>`;
          responseDiv.style.display = "block";
        })
        .catch(() => {
          responseDiv.textContent = "Oops! Something went wrong.";
          responseDiv.style.display = "block";
        })
        .finally(() => {
          setTimeout(() => {
            loadingIndicator.style.display = "none";
            submitButton.disabled = false;
            userInput.disabled = false;
            submitButton.value = "Ask";
            userInput.focus();
         }, 500); 
});
      }, 100); 
    });
  });
</script>

</body>
</html>
